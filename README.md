# Spotify Linker Bot

[![CI](https://github.com/FarhadKhakzad/spotify-linker/actions/workflows/ci.yml/badge.svg)](https://github.com/FarhadKhakzad/spotify-linker/actions/workflows/ci.yml)

پروژه‌ای برای خودکارسازی درج لینک اسپاتیفای در پست‌های کانال تلگرام. این مخزن قدم‌به‌قدم با ساختار حرفه‌ای پیاده‌سازی خواهد شد و شامل اجزای زیر است:

- وب‌سرور سبک مبتنی بر FastAPI جهت دریافت وبهوک تلگرام.
- ماژول اتصال به API اسپاتیفای برای جست‌وجوی دقیق آهنگ‌ها.
- لایه مدیریت کانفیگ و متغیرهای محیطی جهت نگه‌داری امن کلیدها و توکن‌ها.
- تست‌های خودکار برای اطمینان از صحت عملکرد بخش‌های کلیدی.

## شروع سریع

1. اطمینان از نصب Python نسخه 3.11 به بالا.
2. ساخت محیط مجازی و نصب وابستگی‌ها پس از تعریف در فایل `pyproject.toml` (در مراحل بعد تکمیل می‌شود).

```bash
poetry install
```
3. یک نسخه از `env.example` بسازید و مقادیر را در `.env` قرار دهید تا تنظیمات بارگذاری شود.
4. اجرای اسکریپت توسعه محلی جهت دریافت وبهوک آزمایشی و بررسی لاگ‌ها.
5. برای اجرای سرویس در حالت توسعه، دستور زیر را اجرا کنید:

```bash
poetry run uvicorn spotify_linker.main:app --reload
```

6. برای بررسی استانداردهای کدنویسی و تست‌ها پیش از ارسال تغییرات، ابتدا وابستگی‌ها را به‌روزرسانی کنید:

```bash
poetry update
```

7. سپس کیفیت کد و تست‌ها را با اجرای دستورهای زیر بسنجید:

```bash
poetry run ruff check .
poetry run pytest
```

## نقشه راه

این پروژه در چند فاز کوچک توسعه خواهد یافت:

1. ایجاد ساختار اولیه و تنظیمات پایه (در حال انجام).
2. پیاده‌سازی endpoint وبهوک و زیرساخت لاگ‌گیری.
3. اتصال به اسپاتیفای با استفاده از Client Credentials.
4. تحلیل پیام‌های دریافتی و استخراج متادیتای آهنگ.
5. یافتن لینک دقیق اسپاتیفای و پاسخ‌دهی به تلگرام.
6. استقرار روی سرور همیشه روشن و پیکربندی HTTPS/Webhook.

## مدیریت رازها

> ⚠️ **هشدار امنیتی:** فایل `.env` هرگز نباید در مخزن یا اشتراک‌گذاری‌های عمومی قرار بگیرد. برای نگه‌داری امن از ابزارهایی مانند مدیر رمز عبور یا مخزن secrets استفاده کنید.

توکن ربات تلگرام و اطلاعات کلاینت اسپاتیفای در فایل `.env` قرار خواهند گرفت. متغیرهای حیاتی شامل `TELEGRAM_BOT_TOKEN`، `TELEGRAM_CHANNEL_ID`، `SPOTIFY_CLIENT_ID` و `SPOTIFY_CLIENT_SECRET` هستند. فایل نمونه `env.example` نحوه مقداردهی را نشان می‌دهد. این فایل‌ها نباید در مخزن عمومی منتشر شوند.

| متغیر | ضروری؟ | توضیح |
|-------|---------|-------|
| `TELEGRAM_BOT_TOKEN` | بله | توکن دسترسی ربات تلگرام ایجاد شده توسط BotFather. |
| `TELEGRAM_CHANNEL_ID` | بله | شناسه عددی کانالی که بات در آن عضو است (با پیشوند منفی برای کانال‌ها). |
| `SPOTIFY_CLIENT_ID` | بله | شناسهٔ برنامه در داشبورد توسعه‌دهندگان اسپاتیفای. |
| `SPOTIFY_CLIENT_SECRET` | بله | کلید محرمانهٔ اسپاتیفای که برای دریافت توکن استفاده می‌شود. |
| `SPOTIFY_REDIRECT_URI` | اختیاری | مسیر بازگشتی ثبت‌شده در اسپاتیفای؛ برای سناریوهای OAuth آینده نگه داشته می‌شود. |

## مشارکت

تمام تغییرات جدید ابتدا با تأیید صاحب پروژه انجام می‌شوند. برای پیشنهاد تغییر، ابتدا یک شاخه جدید بسازید و پس از بررسی تست‌ها، درخواست ادغام ارسال کنید.
